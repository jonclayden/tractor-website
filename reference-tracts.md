# Reference tracts

Reference tracts represent prior information about tract trajectories, which are used by neighbourhood tractography methods to select corresponding pathways in diffusion data sets. It should be noted that [heuristic](HNT-tutorial.html) and [probabilistic](PNT-tutorial.html) neighbourhood tractography use different forms of reference tract, although if you plan to [create a custom reference](#custom), the process is nearly identical for the two cases.

## Using standard reference tracts

Since version 1.0.0, TractoR has been supplied with a set of standard reference tracts for both heuristic and probabilistic neighbourhood tractography (NT). These reference tracts are based on a white matter tract atlas kindly made available by Dr Susumu Mori's lab at Johns Hopkins University. Further information about the atlas can be found at <http://cmrm.med.jhmi.edu/> and in Ref. (1) below. If you use these reference tracts in your work, please cite Ref. (2) below.

Using these standard references is by far the easiest way to start using NT. TractoR "knows" where to find them, so you need only to specify the tract name when running the `hnt-eval` or `pnt-data` experiment scripts. Available tract names since TractoR version 1.0.0 are "genu" (the corpus callosum genu, or more specifically the forceps anterior), "cst_left" and "cst_right" (left and right corticospinal or pyramidal tracts), "cing_left" and "cing_right" (left and right cingula). TractoR version 1.2.0 added the "splenium" (corpus callosum splenium, forceps posterior), "atr_left" and "atr_right" (left and right anterior thalamic radiations), "arcuate_left" and "arcuate_right" (left and right arcuate fasciculi), "uncinate_left" and "uncinate_right" (left and right uncinate fasciculi). Additional standard references are planned to be added in future releases.

<h2 id="custom">Creating custom reference tracts</h2>

If you wish to segment a tract for which there is not yet a standard reference tract, or if your data set is somehow unusual so that the standard reference tracts are inappropriate, you need to create a custom reference tract from one of your scans. Once created, the reference tract may be reused for later studies.

TractoR scripts which are likely to be useful for creating a custom reference tract include `mkroi` (to create a region of interest), `rtrack` (to generate a series of tract images, from which to choose a reference tract), and `hnt-ref` or `pnt-ref` (to create reference tracts for use with HNT or PNT, respectively).

Let's assume that we wish to create a reference tract representing the corpus callosum genu. We begin by creating a directory for this experiment, and changing to this directory. For example,

    mkdir /expts/hnt-genu
    cd /expts/hnt-genu

Next we observe that the point (6,22,14) - in millimetre coordinates - appears to be within the genu in an MNI standard space brain volume. A suitable location such as this can be chosen using [FSL's data viewer](http://www.fmrib.ox.ac.uk/fsl/fslview/index.html). We see the location shown on a slice of the MNI white matter map below:

![genu seed point location](https://github.com/jonclayden/tractor/wiki/genu-point.png)

We next need to choose a subject in which to generate our reference tract. In this tutorial we will assume that the session directory for this subject is based at the location /data/refsubject. Note that this session *must already* be [fully preprocessed](diffusion-preprocessing.html). We will seed throughout a region around the location corresponding to the point we found in MNI standard space, on the basis that at least one point in this region stands a good chance of generating a tract suitable for use as the reference. The command

    tractor mkroi /data/refsubject 6,22,14 CentreInMNISpace:true PointType:mm ROIName:genu_region

generates a region of interest (called "genu_region.nii.gz" or similar), and then

    tractor rtrack /data/refsubject SeedMaskFile:genu_region CreateImages:true

will generate a (large) number of images representing tracts generated by seeding at each voxel in the ROI. (If this fails to create images, please ensure you have [ImageMagick installed](getting-started.html).) By default, the width of the ROI is 7 voxels in each dimension, although this can be changed with the Width option to `mkroi`. (Note that, in general, you can always see what options are supported by a particular experiment script by giving the command `tractor -o` followed by the script name.) Voxels with very low anisotropy (say, FA less than 0.2) may be excluded, on the basis that they are unlikely to generate useful tracts, using the `SeedThresholdLevel` option to `rtrack`:

    tractor rtrack /data/refsubject SeedMaskFile:genu_region CreateImages:true SeedThresholdType:fa SeedThresholdLevel:0.2

The resulting tract image file names contain the seed point that generated them, *using [the R convention](conventions.html)*. This process, or any other, can be used and repeated until a seed point has been found that produces an acceptable segmentation of the genu for use as a reference tract. The important characteristics are shape and length, so particular care should be taken to ensure that these are appropriate in the reference tract.

Given a chosen seed point, the reference tract can be generated in the appropriate form using the `hnt-ref` or `pnt-ref` scripts, depending on whether you are planning to use heuristic or probabilistic NT. For example,

    tractor hnt-ref /data/refsubject 40,38,22 PointType:R TractName:genu

(The seed point in this example is arbitrary.) This will create a file called genu_ref.Rdata, which contains information about the reference tract for use in the testing phase. The syntax for `pnt-ref` is identical; only the script name needs to be changed.

## References

1. K. Hua et al., *Neuroimage* **39**(1):336-347, 2008.
2. S. Mu√±oz Maniega et al., *Proceedings of the ISMRM* **16**:3318, 2008.